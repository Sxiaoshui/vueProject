{"version":3,"sources":["webpack:///./src/views/authority-manage/relatedPermissions.vue?3efa","webpack:///src/views/authority-manage/relatedPermissions.vue","webpack:///./src/views/authority-manage/relatedPermissions.vue?3544","webpack:///./src/views/authority-manage/relatedPermissions.vue","webpack:///./src/views/authority-manage/relatedPermissions.vue?7dd9"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","isLevel","_v","_s","$route","query","name","EMPTYTEXT","indeterminate","isIndeterminate","on","change","handleCheckAllChange","model","value","callback","$$v","allChecked","expression","ref","data","menuList","show-checkbox","default-checked-keys","selectedMenuIds","node-key","props","check","handleCheckedChange","click","$event","handleBackList","type","handleSave","staticRenderFns","relatedPermissionsvue_type_script_lang_js_","children","label","created","getMenuList","methods","_this","$emit","$http","post","roleId","id","projectType","then","res","code","result","filterSelectArr","allNodeLen","getAllids","length","checkedCount","$message","error","msg","catch","$refs","tree","setCheckedKeys","allArr","selectArr","forEach","item","indexOf","childLen","selectChild","el","push","apply","Object","toConsumableArray","filter","it","index","splice","arr","ids","current","node","checkedKeys","$router","path","_this2","$notify","title","message","parentArr","getHalfCheckedKeys","childArr","getCheckedKeys","menuIds","concat","join","success","authority_manage_relatedPermissionsvue_type_script_lang_js_","component","componentNormalizer","__webpack_exports__","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_10_oneOf_1_0_node_modules_css_loader_index_js_ref_10_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_10_oneOf_1_2_node_modules_less_loader_dist_cjs_js_ref_10_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_relatedPermissions_vue_vue_type_style_index_0_lang_less___WEBPACK_IMPORTED_MODULE_0__","__webpack_require__","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_10_oneOf_1_0_node_modules_css_loader_index_js_ref_10_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_10_oneOf_1_2_node_modules_less_loader_dist_cjs_js_ref_10_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_relatedPermissions_vue_vue_type_style_index_0_lang_less___WEBPACK_IMPORTED_MODULE_0___default","n"],"mappings":"yHAAA,IAAAA,EAAA,WAA0B,IAAAC,EAAAC,KAAaC,EAAAF,EAAAG,eAA0BC,EAAAJ,EAAAK,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,mCAA8C,CAAAF,EAAA,OAAYE,YAAA,aAAwB,CAAAF,EAAA,cAAmBG,MAAA,CAAOC,QAAA,MAAa,GAAAJ,EAAA,OAAgBE,YAAA,aAAwB,CAAAF,EAAA,MAAAJ,EAAAS,GAAA,QAAAT,EAAAU,GAAAV,EAAAW,OAAAC,MAAAC,MAAAb,EAAAc,cAAAV,EAAA,eAA4FE,YAAA,YAAAC,MAAA,CAA+BQ,cAAAf,EAAAgB,iBAAoCC,GAAA,CAAKC,OAAAlB,EAAAmB,sBAAkCC,MAAA,CAAQC,MAAArB,EAAA,WAAAsB,SAAA,SAAAC,GAAgDvB,EAAAwB,WAAAD,GAAmBE,WAAA,eAA0B,CAAAzB,EAAAS,GAAA,UAAAL,EAAA,OAA6BE,YAAA,YAAuB,CAAAF,EAAA,WAAgBsB,IAAA,OAAAnB,MAAA,CAAkBoB,KAAA3B,EAAA4B,SAAAC,gBAAA,GAAAC,uBAAA9B,EAAA+B,gBAAAC,WAAA,KAAAC,MAAAjC,EAAAiC,OAAoHhB,GAAA,CAAKiB,MAAAlC,EAAAmC,wBAAiC,GAAA/B,EAAA,OAAgBE,YAAA,WAAsB,CAAAF,EAAA,aAAkBa,GAAA,CAAImB,MAAA,SAAAC,GAAyB,OAAArC,EAAAsC,oBAA8B,CAAAtC,EAAAS,GAAA,SAAAL,EAAA,aAAkCG,MAAA,CAAOgC,KAAA,WAAiBtB,GAAA,CAAKmB,MAAA,SAAAC,GAAyB,OAAArC,EAAAwC,gBAA0B,CAAAxC,EAAAS,GAAA,oBAC3gCgC,EAAA,eCqCAC,aAAA,CACA7B,KAAA,sBACAc,KAFA,WAGA,OACAM,MAAA,CACAU,SAAA,WACAC,MAAA,SAEAhB,SAAA,GACAG,gBAAA,GACAf,iBAAA,EACAQ,YAAA,IAGAqB,QAdA,WAeA5C,KAAA6C,eAEAC,QAAA,CAEAD,YAFA,WAEA,IAAAE,EAAA/C,KACAA,KAAAgD,MAAA,eACAhD,KAAAiD,MAAAC,KAAA,wDACAC,OAAAnD,KAAAU,OAAAC,MAAAyC,GACAC,YAAA,IACA,GAAAC,KAAA,SAAAC,GACA,SAAAA,EAAAC,KAAA,CACA,IAAAC,EAAAF,EAAA7B,KACAqB,EAAApB,SAAA8B,EAAA9B,UAAA,GACA,IAAAG,EAAA2B,EAAA3B,iBAAA,GACAiB,EAAAjB,gBAAAiB,EAAAW,gBAAAX,EAAApB,SAAAG,GACA,IAAA6B,EAAAZ,EAAAa,UAAAb,EAAApB,UAAAkC,OACAC,EAAAf,EAAAjB,gBAAA+B,OACAd,EAAAxB,WAAAuC,IAAAH,EACAZ,EAAAhC,gBAAA+C,EAAA,GAAAA,EAAAH,OAEAZ,EAAApB,SAAA,GACAoB,EAAAjB,gBAAA,GACAiB,EAAAgB,SAAAC,MAAAT,EAAAU,KAEAlB,EAAAC,MAAA,iBAEAkB,MAAA,SAAAF,GACAjB,EAAAC,MAAA,eACAD,EAAAgB,SAAAC,YAIA9C,qBA9BA,WA+BAlB,KAAA8B,gBAAA,GACA9B,KAAAuB,YACAvB,KAAA8B,gBAAA9B,KAAA4D,UAAA5D,KAAA2B,UACA3B,KAAAmE,MAAAC,KAAAC,eAAArE,KAAA8B,iBACA9B,KAAAe,iBAAA,IAEAf,KAAA8B,gBAAA,GACA9B,KAAAmE,MAAAC,KAAAC,eAAA,IACArE,KAAAe,iBAAA,IAIA2C,gBA3CA,SA2CAY,EAAAC,GAgBA,OAfAD,EAAAE,QAAA,SAAAC,GACA,QAAAF,EAAAG,QAAAD,EAAArB,KACAqB,EAAA/B,SAAA,CACA,IAAAiC,EAAAF,EAAA/B,SAAAmB,OACAe,EAAA,GAIA,GAHAH,EAAA/B,SAAA8B,QAAA,SAAAK,GACAD,EAAAE,KAAAC,MAAAH,EAAAI,OAAAC,EAAA,KAAAD,CAAAT,EAAAW,OAAA,SAAAC,GAAA,OAAAA,IAAAN,EAAAzB,SAEAuB,IAAAC,EAAAf,OAAA,CACA,IAAAuB,EAAAb,EAAAG,QAAAD,EAAArB,IACAmB,EAAAc,OAAAD,EAAA,OAKAb,GAGAX,UA9DA,SA8DA0B,GACA,IAAAC,EAAA,GAWA,OAVAD,EAAAd,QAAA,SAAAC,GACAA,EAAArB,KACAmC,EAAAT,KAAAL,EAAArB,IACAqB,EAAA/B,UACA+B,EAAA/B,SAAA8B,QAAA,SAAAW,GACAI,EAAAT,KAAAK,EAAA/B,SAKAmC,GAGArD,oBA7EA,SA6EAsD,EAAAC,GACA,IAAA9B,EAAA3D,KAAA4D,UAAA5D,KAAA2B,UAAAkC,OACAC,EAAA2B,EAAAC,YAAA7B,OACA7D,KAAAuB,WAAAuC,IAAAH,EACA3D,KAAAe,gBAAA+C,EAAA,GAAAA,EAAAH,EACA3D,KAAA8B,gBAAA2D,EAAAC,aAGArD,eArFA,WAsFArC,KAAA2F,QAAAb,KAAA,CACAc,KAAA,4BAIArD,WA3FA,WA2FA,IAAAsD,EAAA7F,KACA,OAAAA,KAAA8B,gBAAA+B,OAEA,OADA7D,KAAA8F,QAAA,CAAAC,MAAA,KAAAC,QAAA,aAAA1D,KAAA,aACA,EAEA,IAAA2D,EAAAjG,KAAAmE,MAAAC,KAAA8B,qBACAC,EAAAnG,KAAAmE,MAAAC,KAAAgC,iBACAC,EAAAJ,EAAAK,OAAAH,GACAnG,KAAAiD,MAAAC,KAAA,oEACAC,OAAAnD,KAAAU,OAAAC,MAAAyC,GACAiD,UAAAE,KAAA,OACA,GAAAjD,KAAA,SAAAC,GACA,MAAAA,EAAAC,MACAqC,EAAA9B,SAAAyC,QAAA,QACAX,EAAAxD,kBAEAwD,EAAA9B,SAAAC,MAAAT,EAAAU,KAEA4B,EAAA7C,MAAA,iBAEAkB,MAAA,SAAAF,GACA6B,EAAA7C,MAAA,eACA6C,EAAA9B,SAAAC,eCxK2WyC,EAAA,0BCQ3WC,EAAgB1B,OAAA2B,EAAA,KAAA3B,CACdyB,EACA3G,EACA0C,GACF,EACA,KACA,KACA,MAIeoE,EAAA,WAAAF,sECnBf,IAAAG,EAAAC,EAAA,QAAAC,EAAAD,EAAAE,EAAAH,GAA6iBE,EAAG","file":"static/js/chunk-5f6c02f2.93cf1bc1.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"table-detail-box permission-box\"},[_c('div',{staticClass:\"title-box\"},[_c('Breadcrumb',{attrs:{\"isLevel\":2}})],1),_c('div',{staticClass:\"inner-box\"},[_c('h3',[_vm._v(\"当前角色:\"+_vm._s(_vm.$route.query.name||_vm.EMPTYTEXT))]),_c('el-checkbox',{staticClass:\"check-box\",attrs:{\"indeterminate\":_vm.isIndeterminate},on:{\"change\":_vm.handleCheckAllChange},model:{value:(_vm.allChecked),callback:function ($$v) {_vm.allChecked=$$v},expression:\"allChecked\"}},[_vm._v(\"所有菜单\")]),_c('div',{staticClass:\"tree-box\"},[_c('el-tree',{ref:\"tree\",attrs:{\"data\":_vm.menuList,\"show-checkbox\":\"\",\"default-checked-keys\":_vm.selectedMenuIds,\"node-key\":\"id\",\"props\":_vm.props},on:{\"check\":_vm.handleCheckedChange}})],1),_c('div',{staticClass:\"btn-box\"},[_c('el-button',{on:{\"click\":function($event){return _vm.handleBackList()}}},[_vm._v(\"取 消\")]),_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":function($event){return _vm.handleSave()}}},[_vm._v(\"确 认\")])],1)],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/*\r\n * @Author: xiaoshui.candy \r\n * @Date: 2019-06-24 14:59:41 \r\n * @Last Modified by: xiaoshui.candy\r\n * @Last Modified time: 2019-07-10 09:19:52\r\n */\r\n<!-- 关联权限 -->\r\n<template>\r\n  <div class=\"table-detail-box permission-box\">\r\n   <!-- 标题 -->\r\n  <div class=\"title-box\">\r\n    <Breadcrumb :isLevel='2'></Breadcrumb>\r\n  </div> \r\n  <div class=\"inner-box\">\r\n    <h3>当前角色:{{$route.query.name||EMPTYTEXT}}</h3>\r\n    <el-checkbox :indeterminate=\"isIndeterminate\" v-model=\"allChecked\" @change=\"handleCheckAllChange\" class=\"check-box\" >所有菜单</el-checkbox>\r\n    <!-- 权限树 -->\r\n    <div class=\"tree-box\">\r\n      <el-tree\r\n        :data=\"menuList\"\r\n        ref=\"tree\"\r\n        show-checkbox\r\n        :default-checked-keys=\"selectedMenuIds\"\r\n        node-key=\"id\"\r\n        @check=\"handleCheckedChange\"\r\n        :props=\"props\">\r\n      </el-tree>\r\n    </div>\r\n    <!-- 操作 -->\r\n    <div class=\"btn-box\">\r\n      <el-button @click=\"handleBackList()\">取 消</el-button>\r\n      <el-button type=\"primary\" @click=\"handleSave()\">确 认</el-button>\r\n    </div>\r\n  </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name:'related-permissions',\r\n  data() {\r\n    return {\r\n      props: {\r\n        children: 'children',\r\n        label: 'label'\r\n      },\r\n      menuList:[], //用户菜单\r\n      selectedMenuIds:[], //用户已选菜单\r\n      isIndeterminate: true, //全选状态\r\n      allChecked:false, //是否全选\r\n    }\r\n  },\r\n  created() {\r\n    this.getMenuList() //获取用户已选菜单\r\n  },\r\n  methods: {\r\n    //获取用户已选菜单\r\n    getMenuList(){\r\n      this.$emit(\"viewLoad\", true);\r\n      this.$http.post(process.env.VUE_APP_API + '/role/getMenuList',{\r\n        \"roleId\": this.$route.query.id,\r\n        \"projectType\": 2\r\n      },false).then(res => {\r\n        if (res.code===200) {\r\n          let result = res.data\r\n          this.menuList = result.menuList || []\r\n          let selectedMenuIds = result.selectedMenuIds || []\r\n          this.selectedMenuIds = this.filterSelectArr(this.menuList,selectedMenuIds) //移除子集未全部选择的父集id后的选中集合\r\n          let allNodeLen = this.getAllids(this.menuList).length\r\n          let checkedCount = this.selectedMenuIds.length\r\n          this.allChecked = checkedCount === allNodeLen;\r\n          this.isIndeterminate = checkedCount > 0 && checkedCount < allNodeLen;\r\n        } else {\r\n          this.menuList = []\r\n          this.selectedMenuIds = []\r\n          this.$message.error(res.msg);\r\n        }\r\n        this.$emit(\"viewLoad\", false);  \r\n      })\r\n      .catch(error => {\r\n        this.$emit(\"viewLoad\", false);\r\n        this.$message.error(error);\r\n      });\r\n    },\r\n    //设置全选\r\n    handleCheckAllChange () {\r\n      this.selectedMenuIds = []\r\n      if (this.allChecked) {\r\n        this.selectedMenuIds = this.getAllids(this.menuList)\r\n        this.$refs.tree.setCheckedKeys(this.selectedMenuIds)\r\n        this.isIndeterminate = false;\r\n      } else {\r\n        this.selectedMenuIds = []\r\n        this.$refs.tree.setCheckedKeys([])\r\n        this.isIndeterminate = true;\r\n      }\r\n    },\r\n    //移除子集未全部选择的父集id后的选中集合\r\n   filterSelectArr(allArr,selectArr){\r\n      allArr.forEach(item=>{\r\n         if(selectArr.indexOf(item.id)!==-1){\r\n          if(item.children){\r\n            let childLen = item.children.length\r\n            let selectChild = []\r\n            item.children.forEach(el=>{\r\n              selectChild.push(...selectArr.filter(it=>it===el.id))\r\n            })\r\n            if(childLen!==selectChild.length){\r\n              let index = selectArr.indexOf(item.id)\r\n              selectArr.splice(index,1)\r\n            }\r\n          }\r\n        }\r\n      })\r\n      return selectArr\r\n    },\r\n    //获取所有节点id\r\n    getAllids(arr){\r\n      let ids = []\r\n      arr.forEach(item => {\r\n        if(item.id){\r\n          ids.push(item.id)\r\n          if(item.children){\r\n            item.children.forEach(it=>{\r\n              ids.push(it.id)\r\n            })\r\n          }\r\n        }\r\n      })\r\n      return ids\r\n    },\r\n    //节点选中是否选中全选框\r\n    handleCheckedChange(current,node) {\r\n      let allNodeLen = this.getAllids(this.menuList).length\r\n      let checkedCount = node.checkedKeys.length\r\n      this.allChecked = checkedCount === allNodeLen;\r\n      this.isIndeterminate = checkedCount > 0 && checkedCount < allNodeLen;\r\n      this.selectedMenuIds = node.checkedKeys\r\n    },\r\n    //返回列表\r\n    handleBackList() {\r\n      this.$router.push({\r\n        path: '/authority-manage/list'\r\n      })\r\n    },\r\n    //保存设置\r\n    handleSave(){\r\n       if(this.selectedMenuIds.length===0){\r\n          this.$notify({title: '提示',message:'至少选择一个权限关联',type: 'warning'});\r\n          return false\r\n       }\r\n      let parentArr = this.$refs.tree.getHalfCheckedKeys()   //获取半选中状态的id\r\n      let childArr = this.$refs.tree.getCheckedKeys()  //获取全选中的id\r\n      let menuIds = parentArr.concat(childArr)   //拼接在一起\r\n       this.$http.post(process.env.VUE_APP_API + '/role/distributeUserAuthority',{\r\n        roleId: this.$route.query.id,\r\n        menuIds: menuIds.join(\",\")\r\n      },false).then(res => {\r\n        if (res.code===200) {\r\n           this.$message.success('保存成功');\r\n           this.handleBackList() //返回列表\r\n        } else {\r\n          this.$message.error(res.msg);\r\n        }\r\n        this.$emit(\"viewLoad\", false);\r\n      })\r\n      .catch(error => {\r\n        this.$emit(\"viewLoad\", false);\r\n        this.$message.error(error);\r\n      });\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\">\r\n.permission-box{\r\n  .inner-box{\r\n    padding:20px 90px;\r\n    h3{\r\n      font-size:20px;\r\n      color: #ff8a00;\r\n    }\r\n    .check-box{\r\n      margin:30px 0px;\r\n    }\r\n    .el-tree{\r\n      >.el-tree-node{\r\n        margin-bottom:20px;\r\n        >.el-tree-node__content{\r\n          height: 50px;\r\n          line-height: 50px;\r\n          background-color: #fcf7ed;\r\n          border-radius: 4px;\r\n          >.el-checkbox{\r\n            margin-left:25px;\r\n          }\r\n          >.el-icon-caret-right{\r\n            position: absolute;\r\n            right:25px;\r\n            font-size:20px;\r\n            color:#746651;\r\n            &.expanded{\r\n              transform:rotateZ(180deg);\r\n            }\r\n            &.is-leaf{\r\n              display:none;\r\n            }\r\n          }\r\n          >.el-icon-caret-right:before{\r\n            content:\"\\E6DF\";\r\n          }\r\n        }\r\n      }\r\n      .el-tree-node{\r\n        .el-tree-node__children{\r\n          padding:10px 0px;\r\n            .el-tree-node__content{\r\n              height: 40px;\r\n            }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./relatedPermissions.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./relatedPermissions.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./relatedPermissions.vue?vue&type=template&id=78fc94b5&\"\nimport script from \"./relatedPermissions.vue?vue&type=script&lang=js&\"\nexport * from \"./relatedPermissions.vue?vue&type=script&lang=js&\"\nimport style0 from \"./relatedPermissions.vue?vue&type=style&index=0&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./relatedPermissions.vue?vue&type=style&index=0&lang=less&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./relatedPermissions.vue?vue&type=style&index=0&lang=less&\""],"sourceRoot":""}